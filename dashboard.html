<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gold Rate Poster</title>

<style>
body{
  font-family: Arial;
  background: linear-gradient(135deg,#b8860b,#ffd700);
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}

.box{
  background:white;
  padding:25px;
  border-radius:12px;
  text-align:center;
  width:340px;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
}

.logo-preview{
  width:120px;
  height:120px;
  border:1px solid #ccc;
  margin:auto;
  display:flex;
  align-items:center;
  justify-content:center;
  margin-bottom:10px;
}

.logo-preview img{
  max-width:100%;
  max-height:100%;
}

input{
  width:100%;
  padding:8px;
  margin:5px 0;
  border-radius:6px;
  border:1px solid #ccc;
}

button{
  width:100%;
  padding:12px;
  background:#b8860b;
  color:white;
  border:none;
  border-radius:6px;
  font-weight:bold;
  cursor:pointer;
  margin-top:8px;
}

button:hover{
  background:#a07600;
}
</style>
</head>

<body>

<div class="box">

<h3>Gold Rate Poster</h3>

<div class="logo-preview" id="logoPreview">
No Logo
</div>

<input type="file" accept="image/*" onchange="saveLogo(event)">

<h4>Contact Numbers (Max 3)</h4>

<input type="text" id="num1" placeholder="Phone Number 1">
<input type="text" id="num2" placeholder="Phone Number 2">
<input type="text" id="num3" placeholder="Phone Number 3">

<button onclick="saveContacts()">Save Details</button>

<button onclick="generatePoster()">Download Poster</button>

</div>

<script>

// ====== BACKGROUND LIST ======
const backgrounds = [
"https://drive.google.com/uc?export=view&id=FILE_ID1",
"https://drive.google.com/uc?export=view&id=FILE_ID2",
"https://drive.google.com/uc?export=view&id=FILE_ID3"
];

const templates = [1,2];

// ====== LOAD SAVED DATA ======
window.onload = function(){

  const savedLogo = localStorage.getItem("logo");
  if(savedLogo){
    document.getElementById("logoPreview").innerHTML =
    "<img src='"+savedLogo+"'>";
  }

  document.getElementById("num1").value = localStorage.getItem("num1") || "";
  document.getElementById("num2").value = localStorage.getItem("num2") || "";
  document.getElementById("num3").value = localStorage.getItem("num3") || "";
}

// ====== SAVE LOGO ======
function saveLogo(event){
  const reader = new FileReader();
  reader.onload = function(){
    localStorage.setItem("logo", reader.result);
    document.getElementById("logoPreview").innerHTML =
    "<img src='"+reader.result+"'>";
  }
  reader.readAsDataURL(event.target.files[0]);
}

// ====== SAVE CONTACTS ======
function saveContacts(){
  localStorage.setItem("num1", document.getElementById("num1").value);
  localStorage.setItem("num2", document.getElementById("num2").value);
  localStorage.setItem("num3", document.getElementById("num3").value);
  alert("Saved Successfully");
}

// ====== DATE BASED RANDOM ======
function getSeed(){
  const today = new Date().toISOString().slice(0,10);
  let seed = 0;
  for(let i=0;i<today.length;i++){
    seed += today.charCodeAt(i);
  }
  return seed;
}

function seededRandom(seed){
  const x = Math.sin(seed) * 10000;
  return x - Math.floor(x);
}

// ====== GENERATE POSTER ======
function generatePoster(){

  const seed = getSeed();
  const bgIndex = Math.floor(seededRandom(seed) * backgrounds.length);
  const templateIndex = Math.floor(seededRandom(seed+5) * templates.length);

  createPoster(backgrounds[bgIndex], templates[templateIndex]);
}

// ====== CREATE A4 ======
function createPoster(bgUrl, template){

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  canvas.width = 2480;
  canvas.height = 3508;

  const bg = new Image();
  bg.crossOrigin="anonymous";
  bg.src = bgUrl;

  bg.onload = function(){

    ctx.drawImage(bg,0,0,2480,3508);

    const logoData = localStorage.getItem("logo");

    if(logoData){
      const logo = new Image();
      logo.src = logoData;
      logo.onload=function(){
        ctx.drawImage(logo,890,200,700,700);
        drawDetails(ctx);
        save(canvas);
      }
    } else {
      drawDetails(ctx);
      save(canvas);
    }

  };
}

let shopName = "";
let logoUrl = "";
let contacts = [];
let backgrounds = [];

let gold22Rate = "";
let gold24Rate = "";
let silverRate = "";
let rateDate = "";

window.onload = function(){

  const phone = localStorage.getItem("userPhone");

  if(!phone){
    alert("Login required");
    window.location.href = "index.html";
    return;
  }

  // =========================
  // 1️⃣ Fetch User Data
  // =========================
  fetch("YOUR_WEBAPP_URL?type=user&phone=" + phone)
  .then(res => res.json())
  .then(data => {

    if(data.error){
      alert("User not found");
      return;
    }

    shopName = data.shop;
    logoUrl = data.logo;

    contacts = [
      data.contact1,
      data.contact2,
      data.contact3
    ].filter(n => n);

  })
  .catch(err => {
    console.log("User fetch error:", err);
  });


  // =========================
  // 2️⃣ Fetch Gold & Silver Rates
  // =========================
  fetch("YOUR_WEBAPP_URL?type=rates")
  .then(res => res.json())
  .then(data => {

    gold22Rate = data.gold22;
    gold24Rate = data.gold24;
    silverRate = data.silver;
    rateDate = data.date;

  })
  .catch(err => {
    console.log("Rate fetch error:", err);
  });


  // =========================
  // 3️⃣ Fetch Background List
  // =========================
  fetch("YOUR_WEBAPP_URL?type=backgrounds")
  .then(res => res.json())
  .then(data => {

    backgrounds = data;

  })
  .catch(err => {
    console.log("Background fetch error:", err);
  });

};
function drawDetails(ctx){

  ctx.fillStyle="white";
  ctx.textAlign="center";

  ctx.font="bold 150px Arial";
  ctx.fillText(shopName,1240,200);

  if(logoUrl){
    const logo = new Image();
    logo.crossOrigin="anonymous";
    logo.src = logoUrl;
    logo.onload=function(){
      ctx.drawImage(logo,890,300,700,700);
    }
  }

  ctx.font="bold 180px Arial";
  ctx.fillText("GOLD 22K : ₹6000",1240,3000);

  ctx.font="bold 120px Arial";
  ctx.fillText("For more details:",1240,3250);

  ctx.font="bold 110px Arial";
  ctx.fillText(contacts.join("  |  "),1240,3400);
}
// ====== DRAW DETAILS ======
function drawDetails(ctx){

  ctx.fillStyle="white";
  ctx.textAlign="center";

  ctx.font="bold 180px Arial";
  ctx.fillText("GOLD 22K : ₹6000",1240,3000);

  ctx.font="bold 120px Arial";
  ctx.fillText("For more details:",1240,3250);

  ctx.font="bold 110px Arial";

  const numbers = [
    localStorage.getItem("num1"),
    localStorage.getItem("num2"),
    localStorage.getItem("num3")
  ].filter(n => n);

  ctx.fillText(numbers.join("  |  "),1240,3400);
}

// ====== SAVE FILE ======
function save(canvas){
  const link=document.createElement("a");
  link.download="A4_Gold_Rate_Poster.png";
  link.href=canvas.toDataURL("image/png");
  link.click();
}

</script>


</body>
</html>
