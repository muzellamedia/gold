  <!DOCTYPE html>
  <html>
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gold Rate Poster</title>

  <style>
  body{
    font-family: Arial;
    background: linear-gradient(135deg,#b8860b,#ffd700);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    margin:0;
  }

  .box{
    background:white;
    padding:25px;
    border-radius:12px;
    text-align:center;
    width:340px;
    box-shadow:0 10px 25px rgba(0,0,0,0.2);
  }

  .logo-preview{
    width:120px;
    height:120px;
    border:1px solid #ccc;
    margin:auto;
    display:flex;
    align-items:center;
    justify-content:center;
    margin-bottom:10px;
  }

  .logo-preview img{
    max-width:100%;
    max-height:100%;
  }

  input{
    width:100%;
    padding:8px;
    margin:5px 0;
    border-radius:6px;
    border:1px solid #ccc;
  }

  button{
    width:100%;
    padding:12px;
    background:#b8860b;
    color:white;
    border:none;
    border-radius:6px;
    font-weight:bold;
    cursor:pointer;
    margin-top:8px;
  }

  button:hover{
    background:#a07600;
  }
  </style>
  </head>

  <body>

  <div class="box">

  <h3>Gold Rate Poster</h3>

  <div class="logo-preview" id="logoPreview">
  No Logo
  </div>

  <input type="file" accept="image/*" onchange="saveLogo(event)">

  <h4>Contact Numbers (Max 3)</h4>

  <input type="text" id="num1" placeholder="Phone Number 1">
  <input type="text" id="num2" placeholder="Phone Number 2">
  <input type="text" id="num3" placeholder="Phone Number 3">

  <button onclick="saveContacts()">Save Details</button>

  <button onclick="generatePoster()">Download Poster</button>

  </div>

  <script>

  // =====================
  // GLOBAL VARIABLES
  // =====================
  let shopName = "";
  let logoUrl = "";
  let contacts = [];
  let backgrounds = [];

  let gold22Rate = "";
  let gold24Rate = "";
  let silverRate = "";
  let rateDate = "";

const API_URL = "https://script.google.com/macros/s/AKfycbzY6dxJXVZcWmx5iyZOxBGyjkHthrPIYJ6df1_EFQ3saJvmC_fgvsRWKRwOxT9cCHqUCQ/exec";



  // =====================
  // PAGE LOAD
  // =====================
  window.onload = function(){

    const phone = localStorage.getItem("userPhone");

    if(!phone){
      alert("Login required");
      window.location.href = "index.html";
      return;
    }

    // USER DATA
    fetch(API_URL + "?type=user&phone=" + phone)
    .then(res => res.json())
    .then(data => {

      shopName = data.shop || "";
      logoUrl = data.logo || "";

      contacts = [
        data.contact1,
        data.contact2,
        data.contact3
      ].filter(n => n);

    });

    // RATES
    fetch(API_URL + "?type=rates")
    .then(res => res.json())
    .then(data => {

      gold22Rate = data.gold22 || "";
      gold24Rate = data.gold24 || "";
      silverRate = data.silver || "";
      rateDate = data.date || "";

    });

    // BACKGROUNDS
    fetch(API_URL + "?type=backgrounds")
    .then(res => res.json())
    .then(data => {
      backgrounds = data || [];
    });

  };

    function saveDetails(){

  const phone = localStorage.getItem("userPhone");

  const fileInput = document.querySelector("input[type='file']");
  const file = fileInput.files[0];

  if(!file){
    alert("Upload logo first");
    return;
  }

  const reader = new FileReader();

  reader.onload = function(){

    fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({
        phone: phone,
        logoBase64: reader.result,
        contact1: document.getElementById("num1").value,
        contact2: document.getElementById("num2").value,
        contact3: document.getElementById("num3").value
      })
    })
    .then(res => res.json())
    .then(data => {
      alert("Saved Successfully");
    });

  };

  reader.readAsDataURL(file);
}

    function saveLogo(event){
  const reader = new FileReader();
  reader.onload = function(){
    logoUrl = reader.result;
    document.getElementById("logoPreview").innerHTML =
      "<img src='" + reader.result + "'>";
  };
  reader.readAsDataURL(event.target.files[0]);
}

function saveContacts(){
  contacts = [
    document.getElementById("num1").value,
    document.getElementById("num2").value,
    document.getElementById("num3").value
  ].filter(n => n);

  alert("Saved Successfully");
}

  // =====================
  // RANDOM
  // =====================
  function getSeed(){
    const today = new Date().toISOString().slice(0,10);
    let seed = 0;
    for(let i=0;i<today.length;i++){
      seed += today.charCodeAt(i);
    }
    return seed;
  }

  function seededRandom(seed){
    const x = Math.sin(seed) * 10000;
    return x - Math.floor(x);
  }


  // =====================
  // DOWNLOAD
  // =====================
  function generatePoster(){

    if(backgrounds.length === 0){
      alert("Backgrounds not loaded yet");
      return;
    }

    const seed = getSeed();
    const bgIndex = Math.floor(seededRandom(seed) * backgrounds.length);

    createPoster(backgrounds[bgIndex]);
  }


  // =====================
  // CREATE POSTER
  // =====================
  function createPoster(bgUrl){
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = 2480;
    canvas.height = 3508;

    const bg = new Image();
    bg.crossOrigin="anonymous";
    bg.src = bgUrl;

    bg.onload = function(){

      ctx.drawImage(bg,0,0,2480,3508);

      const templateList = [template1, template2, template3];

      const seed = getSeed();
      const index = Math.floor(seededRandom(seed+10) * templateList.length);

      templateList[index](ctx, canvas);
    };
  }


  // =====================
  // TEMPLATE 1
  // =====================
  function template1(ctx, canvas){

    ctx.fillStyle="white";
    ctx.textAlign="center";

    ctx.font="bold 160px Arial";
    ctx.fillText(shopName,1240,250);

    if(logoUrl){
      const logo = new Image();
      logo.crossOrigin="anonymous";
      logo.src = logoUrl;

      logo.onload = function(){
  ctx.drawImage(logo,840,350,800,800);
  drawRates(ctx);
  drawContacts(ctx);
  save(canvas);
};
    } else {
  drawRates(ctx);
  drawContacts(ctx);
  save(canvas);
}
  }


  // =====================
  // TEMPLATE 2
  // =====================
  function template2(ctx, canvas){

    ctx.fillStyle="white";
    ctx.textAlign="left";

    if(logoUrl){
      const logo = new Image();
      logo.crossOrigin="anonymous";
      logo.src = logoUrl;

      logo.onload = function(){
  ctx.drawImage(logo,200,300,700,700);
  drawRatesLeft(ctx);
  drawContacts(ctx);
  save(canvas);
};

    } else {
  drawRatesLeft(ctx);
  drawContacts(ctx);
  save(canvas);
}
  }


  // =====================
  // TEMPLATE 3
  // =====================
  function template3(ctx, canvas){

    ctx.fillStyle="white";
    ctx.textAlign="center";

    ctx.font="bold 250px Arial";
    ctx.fillText("₹ " + gold22Rate,1240,1700);

    ctx.font="bold 140px Arial";
    ctx.fillText("GOLD 22K",1240,1900);

    ctx.font="bold 160px Arial";
    ctx.fillText("SILVER ₹ " + silverRate,1240,2200);

    drawContacts(ctx);
    save(canvas);
  }


  // RATES
  // =====================
  function drawRates(ctx){

    ctx.font="bold 200px Arial";
    ctx.fillText("GOLD 22K",1240,1700);
    ctx.fillText("₹ " + gold22Rate,1240,1950);

    ctx.font="bold 160px Arial";
    ctx.fillText("SILVER",1240,2300);
    ctx.fillText("₹ " + silverRate,1240,2500);
  }


  // =====================
  // CONTACTS
  // =====================
  function drawContacts(ctx){

    ctx.textAlign="center";

    ctx.font="bold 110px Arial";
    ctx.fillText("For more details:",1240,3200);

    ctx.font="bold 100px Arial";
    ctx.fillText(contacts.join("  |  "),1240,3350);

    ctx.font="bold 80px Arial";
    ctx.fillText("Rate Date: " + rateDate,1240,3500);
  }


  // =====================
  // SAVE
  // =====================
  function save(canvas){
    const link = document.createElement("a");
    link.download = "A4_Gold_Rate_Poster.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  }

  </script>


  </body>
  </html>
